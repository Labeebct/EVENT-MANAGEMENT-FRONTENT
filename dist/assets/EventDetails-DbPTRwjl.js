import{c as z,s as A,h as q,o as m,u as B,b as L,a as O,d as b,r as c,e as E,j as e,B as R}from"./index-G4zhL9fC.js";import{S as Y}from"./react-select.esm-Dy6FNCHW.js";import{s as _}from"./scrollToTop-B5_ltFAX.js";const $=()=>new Promise(r=>{const s=document.createElement("script");s.src="https://checkout.razorpay.com/v1/checkout.js",s.onload=()=>{r(!0)},s.onerror=()=>{r(!1)},document.body.appendChild(s)});let W,M,G;const F=async(r,s,a)=>{const y=localStorage.getItem("bookedEvent"),l=JSON.parse(y);if(!await $()){alert("Razorpay SDK Failed to load");return}const f=await z.post("/payment",{advanceAmount:l.amount}),{orderId:h}=f.data;var v={key:"rzp_test_WsQWHQupL11gz0",name:"Labio",currency:l.currency,amount:l.amount,order_id:h,description:"Thankyou for your advance amount",image:"https://manuarora.in/logo.png",handler:async function(w){try{const n=await z.post("/payment-check",{response:w,orderId:h,bookedEvent:l}),{data:g,status:p}=n;p==200&&(a.emit("BOOKING_COMPLETED",g.bookedEvent),s(A()),setTimeout(()=>{s(q()),s(m(W="booked",M="You Event has been succesfully booked",G=`We are pleased to inform you
                             that your event has been successfully booked.
                              An email containing the details of your assigned
                               agent has been sent to your email address. Additionally,
                                we will share your information with the agent so you can
                                 communicate directly.If you have any further questions or encounter any issues,
                                  please do not hesitate to contact us directly`))},5e3))}catch(n){if(n.response){const{status:g,data:p}=n.response;g==500&&Navigate("/500")}else console.log("No response from the server")}},prefill:{name:r.username,email:r.email,contact:"9999999999"}};new window.Razorpay(v).open()},J=()=>{const r=B(),s=L(),a=O(),y=localStorage.getItem("jwt"),l=b(t=>t.socket.socket),f=new URLSearchParams(s.search).get("id"),h=b(t=>t.confirm.proceedPending),v=b(t=>t.confirm.proceedToPay);b(t=>t.confirm.bookedEvent);const[o,w]=c.useState({}),[n,g]=c.useState(null),[p,S]=c.useState(""),[x,I]=c.useState(null);let d,u;c.useEffect(()=>{let t=null;if(y){const i=E();t=i==null?void 0:i.userId}const k=t?`/view-event?id=${f}&userId=${t}`:`/view-event?id=${f}`;(async()=>{try{a({type:"loading",payload:!0});const i=await z.get(k);a({type:"loading",payload:!1});const{data:j,status:N}=i;N===200&&(w(j.event),g(j.findEventBooked))}catch(i){if(i.response){const{data:j,status:N}=i.response;N===500&&r("/500")}else r("/500")}})()},[f,s]),c.useEffect(()=>{y&&n!==null&&(n&&!n.isConfirmed?a(m("pending",d="Booking Request Sent",u="Your event booking request has been submitted. Once approved by the agent, you will be directed to the payment section to finalize your booking. Thank you for choosing us, and we anticipate confirming your reservation shortly")):n&&n.isConfirmed&&!n.isPaymentDone?a(m("proceed_payment",d="Your request has been approved",u="We are happy to inform you that your recent request has been reviewed and approved. You can now proceed to payment to confirm your booking.")):n&&n.isCancelled&&a(m("cancell_request",d="Your request has been rejected",u="We regret to inform you that your recent request has been reviewed and rejected by our agent due to certain reasons. We apologize for any inconvenience and encourage you to check other available options.")))},[n,a,y]),c.useEffect(()=>{if(h){a({type:"loading",payload:!0}),localStorage.getItem("jwt");const t=E(),k={amount:o.advanceAmount,selectedDate:x.value,event:o,agent:o.agentId,user:t.userId};l.emit("bookEvent",k),setTimeout(()=>{a({type:"loading",payload:!1}),a(m("pending",d="Booking Request Sent",u="Your event booking request has been submitted. Once approved by the agent, you will be directed to the payment section to finalize your booking. Thank you for choosing us, and we anticipate confirming your reservation shortly"))},3e3)}return()=>{a({type:"CANCEL_PAYMENT"})}},[h,a]);const P=t=>I(t),T=o.availableDates?o.availableDates.map(t=>({value:t,label:new Date(t).toLocaleDateString("en-US")})):[],C=()=>{if(d="Confirm to Booking",u=`Are you sure you want to book the event with the selected date? If you proceed, you will be charged â‚¹${o.advanceAmount} as a booking charge, which is non-refundable. Proceed to get to the payment section.`,x){const t=localStorage.getItem("jwt");a(t?m("confirm",d,u,x,o.advanceAmount):m("login",d="Login to book the event",u="You need to log in to book the event. Press the login button to log in/register."))}else return S("Please choose your venue date.")};return c.useEffect(()=>{if(v){const t=E();F(t,a,l)}},[v]),p&&setTimeout(()=>S(""),2e3),e.jsxs("div",{className:"h-auto mt-10 relative overflow-hidden sm:-mt-6  flex flex-col md:flex-row w-[80%] shadow-box",children:[e.jsx("div",{className:`absolute top-0 transition-transform p-1 ${p?"translate-x-0":"translate-x-56"} duration-300 ease-linear  right-0`,children:e.jsx(R,{type:"error",msg:p})}),e.jsx("div",{className:"h-auto p-4 flex-1 flex justify-center items-center",children:e.jsx("img",{src:`https://eventapi.labio.shop/${o.eventImage}`,className:"max-w-[42rem] max-h-[32rem]  w-[18rem] md:w-full  h-auto ",alt:""})}),e.jsx("div",{className:"h-full flex-1 flex justify-center px-4 py-4 md:py-8",children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"text-[1.3rem] capitalize pl-1 font-bold font-inter my-1",children:o.venueName}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["Category: ",o.category]}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["Price: ",o.price," / day"]}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["Advance: ",o.advanceAmount," Rs"]}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["Capacity: ",o.capacity," No"]}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["Start Time: ",o.startTime]}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["End Time: ",o.endTime]}),e.jsxs("div",{className:"text-[.9rem] items-center gap-4 flex pl-1 font-roboto capitalize text-gray-700",children:[e.jsx("p",{children:"Available Dates : "}),e.jsx(Y,{className:"capitalize w-[60%]",options:T,value:x,onChange:P,placeholder:"Select a date"})]}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["Location: ",o.country,",",o.state,",",o.city]}),e.jsxs("div",{className:"text-[.9rem] pl-1 font-roboto capitalize text-gray-700",children:["Discription: ",o.country,e.jsx("textarea",{name:"",disabled:!0,value:o.discription,className:"w-full h-[5rem] p-2 text-.9rem shadow-sm resize-none border my-2",id:""})]}),e.jsx("button",{onClick:C,className:"bg-cusOrange text-[.8rem] sm:text-[.9rem] md:text-[1rem] font-inter ease-in-out duration-200 active:scale-[.97] w-full filter text-white shadow-box py-3",children:"Book Now"})]})})]})},K=()=>(_(),e.jsx("div",{className:"h-auto py-10 w-full min-h-[calc(100vh-4.5rem)] flex justify-center items-center",children:e.jsx(J,{})})),X=()=>e.jsx(K,{});export{X as default};
